<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEスケジュール管理システム V2</title>
    
    <!-- 外部ライブラリ -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- カスタムCSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <div id="messageContainer"></div>

    <!-- ========= ログイン画面（既存のHTMLをそのまま使用）========= -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <!-- 既存のログイン画面HTMLをそのまま保持 -->
    </div>

    <!-- ========= メインインターフェース（既存のHTMLをそのまま使用）========= -->
    <div id="mainInterface" style="display:none;" class="flex">
        <!-- 既存のメインインターフェースHTMLをそのまま保持 -->
        
        <!-- 追加：Firebase接続状態表示 -->
        <div class="fixed bottom-4 right-4 text-xs">
            <div id="firebaseStatus" class="bg-white bg-opacity-80 px-2 py-1 rounded">
                🔄 Firebase初期化中...
            </div>
        </div>
    </div>

    <!-- ========= JavaScript読み込み（順序重要）========= -->
    <!-- 1. Firebase設定（最優先） -->
    <script src="js/core/firebase-config.js"></script>
    
    <!-- 2. 認証システム -->
    <script src="js/auth/auth-core.js"></script>
    <script src="js/auth/login-ui.js"></script>

    <!-- 3. 既存のV1機能（後で段階的に分離） -->
    <script>
        // 既存のV1 JavaScriptコードをここに一時的に配置
        // 後のPhaseで段階的に外部ファイルに移動します
        
        // ここに現在のindex.htmlの<script>タグ内容をコピー
        // ただし、以下は除外：
        // - firebaseConfig関連（既に分離済み）
        // - handleUserIdChange, handleLogin関連（既に分離済み）
        // - Ver2安定版修復パッチ（不要）
    </script>

    <!-- 4. 保護システム -->
    <script>
        // 認証モジュール保護
        (function() {
            'use strict';
            
            console.log('🔒 Phase 1 保護システム開始');
            
            // 重要オブジェクトの保護
            if (window.authSystem) {
                Object.freeze(window.authSystem);
                console.log('🔒 認証システム保護完了');
            }
            
            // 整合性チェック（30秒ごと）
            setInterval(() => {
                if (!window.authSystem || typeof window.authSystem.handleLogin !== 'function') {
                    console.error('🚨 認証システム破損検出');
                    alert('重要なシステムコンポーネントが破損しました。ページを再読み込みします。');
                    location.reload();
                }
            }, 30000);
            
            console.log('✅ Phase 1 保護システム初期化完了');
        })();
    </script>
</body>
</html>
