<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase接続テスト</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 50px; 
            background: #f0f0f0; 
        }
        .test-box { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        .button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 5px; 
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-box">
        <h1>Firebase接続テスト + ファイル読み込みテスト</h1>
        <div id="status">テスト待機中...</div>
        
        <button class="button" onclick="testFirebase()">Firebase接続テスト</button>
        <button class="button" onclick="testFileLoading()">ファイル読み込みテスト</button>
        <button class="button" onclick="clearLog()">ログクリア</button>
        
        <div id="results" style="margin-top: 20px;"></div>
        <div id="log-area" class="log-area"></div>
    </div>

    <!-- Firebase Scripts -->
    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log-area');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }
        
        function clearLog() {
            document.getElementById('log-area').innerHTML = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('status').textContent = 'ログクリア完了';
        }
    </script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" 
            onload="log('Firebase App読み込み完了', 'success')" 
            onerror="log('Firebase App読み込み失敗', 'error')"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js" 
            onload="log('Firebase Auth読み込み完了', 'success')" 
            onerror="log('Firebase Auth読み込み失敗', 'error')"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js" 
            onload="log('Firebase Database読み込み完了', 'success')" 
            onerror="log('Firebase Database読み込み失敗', 'error')"></script>

    <script>
        function testFirebase() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                log('Firebase接続テスト開始');
                statusDiv.innerHTML = '<span class="success">Firebase接続テスト実行中...</span>';
                
                // Firebase存在確認
                if (!window.firebase) {
                    throw new Error('Firebase未読み込み');
                }
                log('Firebase オブジェクト確認済み', 'success');
                
                // Firebase初期化
                const firebaseConfig = {
                    apiKey: "AIzaSyC7VLauLy9vkEcBZHrQ3wKJYm_A6DbJHQ8",
                    authDomain: "ce-schedule-system.firebaseapp.com",
                    databaseURL: "https://ce-schedule-system-default-rtdb.firebaseio.com",
                    projectId: "ce-schedule-system",
                    storageBucket: "ce-schedule-system.appspot.com",
                    messagingSenderId: "461684979105",
                    appId: "1:461684979105:web:1234567890abcdef"
                };
                
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                    log('Firebase アプリ初期化完了', 'success');
                } else {
                    log('Firebase アプリは既に初期化済み', 'warning');
                }
                
                // Auth存在確認
                if (firebase.auth) {
                    log('Firebase Auth確認済み', 'success');
                } else {
                    throw new Error('Firebase Auth未読み込み');
                }
                
                // Database存在確認
                if (firebase.database) {
                    log('Firebase Database確認済み', 'success');
                } else {
                    throw new Error('Firebase Database未読み込み');
                }
                
                statusDiv.innerHTML = '<span class="success">✓ Firebase接続テスト成功</span>';
                resultsDiv.innerHTML = '<p class="success">✓ Firebase全機能が正常に動作しています</p>';
                log('Firebase接続テスト完了', 'success');
                
            } catch (error) {
                statusDiv.innerHTML = '<span class="error">✗ Firebase接続テスト失敗</span>';
                resultsDiv.innerHTML = `<p class="error">エラー: ${error.message}</p>`;
                log(`Firebase接続エラー: ${error.message}`, 'error');
                console.error('Firebase接続エラー:', error);
            }
        }
        
        function testFileLoading() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<span class="success">ファイル読み込みテスト実行中...</span>';
            
            log('ファイル読み込みテスト開始');
            
            // 必要なファイルリスト
            const requiredFiles = [
                'js/data/constants.js',
                'js/utils/ui-utils.js',
                'js/schedule/event-manager.js',
                'js/dashboard-core.js',
                'js/dashboard-main.js'
            ];
            
            let loadedCount = 0;
            let errorCount = 0;
            
            requiredFiles.forEach(filePath => {
                fetch(filePath)
                    .then(response => {
                        if (response.ok) {
                            log(`✓ ${filePath} 読み込み成功`, 'success');
                            loadedCount++;
                        } else {
                            log(`✗ ${filePath} 読み込み失敗 (${response.status})`, 'error');
                            errorCount++;
                        }
                        
                        // 全ファイルチェック完了時
                        if (loadedCount + errorCount === requiredFiles.length) {
                            if (errorCount === 0) {
                                statusDiv.innerHTML = '<span class="success">✓ 全ファイル読み込み成功</span>';
                                log('全ファイル読み込みテスト完了', 'success');
                            } else {
                                statusDiv.innerHTML = '<span class="error">✗ 一部ファイル読み込み失敗</span>';
                                log(`ファイル読み込みテスト完了 (${errorCount}個のエラー)`, 'error');
                            }
                        }
                    })
                    .catch(error => {
                        log(`✗ ${filePath} アクセスエラー: ${error.message}`, 'error');
                        errorCount++;
                        
                        // 全ファイルチェック完了時
                        if (loadedCount + errorCount === requiredFiles.length) {
                            statusDiv.innerHTML = '<span class="error">✗ ファイル読み込みテスト失敗</span>';
                            log(`ファイル読み込みテスト完了 (${errorCount}個のエラー)`, 'error');
                        }
                    });
            });
        }
        
        // ページ読み込み完了時に自動実行
        window.addEventListener('load', function() {
            log('ページ読み込み完了');
            log('Firebase自動テストを5秒後に実行します...');
            setTimeout(() => {
                testFirebase();
            }, 5000);
        });
    </script>
</body>
</html>
