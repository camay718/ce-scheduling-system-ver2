<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CE„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† V2 - „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-semibold text-gray-900">CE„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† V2</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userNameDisplay" class="text-sm text-gray-600"></span>
                    <button id="logoutBtn" class="text-sm text-red-600 hover:text-red-800">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                </div>
            </div>
        </div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫ -->
        <div id="loadingIndicator" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6">
                <div class="flex items-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <span class="ml-3">Ë™≠„ÅøËæº„Åø‰∏≠...</span>
                </div>
            </div>
        </div>

        <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <div class="px-4 py-6 sm:px-0">
            <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Çø„Éñ -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex space-x-8">
                    <button id="scheduleTab" class="tab-button py-2 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm">
                        „Çπ„Ç±„Ç∏„É•„Éº„É´
                    </button>
                    <button id="tasksTab" class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        „Çø„Çπ„ÇØ
                    </button>
                    <button id="adminTab" class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm" style="display: none;">
                        ÁÆ°ÁêÜËÄÖ
                    </button>
                </nav>
            </div>

            <!-- „Çπ„Ç±„Ç∏„É•„Éº„É´„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="scheduleContent" class="tab-content">
                <!-- Êó•‰ªòÈÅ∏Êäû -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">„Çπ„Ç±„Ç∏„É•„Éº„É´Ë°®Á§∫</h2>
                    <div class="flex items-center space-x-4">
                        <div>
                            <label for="dateInput" class="block text-sm font-medium text-gray-700">Êó•‰ªòÈÅ∏Êäû</label>
                            <input type="date" id="dateInput" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="viewModeSelect" class="block text-sm font-medium text-gray-700">Ë°®Á§∫„É¢„Éº„Éâ</label>
                            <select id="viewModeSelect" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="daily">Êó•Ë°®Á§∫</option>
                                <option value="weekly">ÈÄ±Ë°®Á§∫</option>
                                <option value="monthly">ÊúàË°®Á§∫</option>
                            </select>
                        </div>
                        <button id="todayBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">‰ªäÊó•</button>
                    </div>
                </div>

                <!-- „Çπ„Ç±„Ç∏„É•„Éº„É´Ë°®Á§∫„Ç®„É™„Ç¢ -->
                <div id="scheduleDisplay" class="bg-white rounded-lg shadow">
                    <div class="p-6">
                        <div id="scheduleContent" class="space-y-4">
                            <!-- „Çπ„Ç±„Ç∏„É•„Éº„É´„Ç¢„Ç§„ÉÜ„É†„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- „Çø„Çπ„ÇØ„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="tasksContent" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ</h3>
                        <div id="todayTasks" class="space-y-3">
                            <!-- „Çø„Çπ„ÇØ„Ç¢„Ç§„ÉÜ„É†„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>

                    <!-- ‰ªäÈÄ±„ÅÆ„Çø„Çπ„ÇØ -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">‰ªäÈÄ±„ÅÆ„Çø„Çπ„ÇØ</h3>
                        <div id="weekTasks" class="space-y-3">
                            <!-- „Çø„Çπ„ÇØ„Ç¢„Ç§„ÉÜ„É†„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÁÆ°ÁêÜËÄÖ„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="adminContent" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ</h3>
                        <button id="userManagementBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜÁîªÈù¢„Å∏
                        </button>
                    </div>

                    <!-- „Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">„Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö</h3>
                        <button id="systemSettingsBtn" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Ë®≠ÂÆöÁîªÈù¢„Å∏
                        </button>
                    </div>

                    <!-- Áõ£Êüª„É≠„Ç∞ -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Áõ£Êüª„É≠„Ç∞</h3>
                        <button id="auditLogBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            „É≠„Ç∞Á¢∫Ë™ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫„Ç®„É™„Ç¢ -->
    <div id="messageArea" class="fixed top-4 right-4 z-50"></div>

    <script>
        // FirebaseË®≠ÂÆö
        const firebaseConfig = {
            databaseURL: "https://ce-schedule-management-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };

        // FirebaseÂàùÊúüÂåñ
        console.log('üîÑ FirebaseÂàùÊúüÂåñÈñãÂßã...');
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentUser = null;
        let userRole = null;

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        const Utils = {
            // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
            showMessage: function(message, type = 'info', duration = 3000) {
                const messageArea = document.getElementById('messageArea');
                const messageEl = document.createElement('div');
                
                const bgColor = {
                    'success': 'bg-green-500',
                    'error': 'bg-red-500',
                    'warning': 'bg-yellow-500',
                    'info': 'bg-blue-500'
                }[type] || 'bg-blue-500';

                messageEl.className = `${bgColor} text-white px-4 py-2 rounded-lg shadow-lg mb-2`;
                messageEl.textContent = message;
                
                messageArea.appendChild(messageEl);
                
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, duration);
            },

            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫Âà∂Âæ°
            showLoading: function() {
                document.getElementById('loadingIndicator').style.display = 'flex';
            },

            hideLoading: function() {
                document.getElementById('loadingIndicator').style.display = 'none';
            },

            // Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà
            formatDate: function(date) {
                if (!(date instanceof Date)) {
                    date = new Date(date);
                }
                return date.toLocaleDateString('ja-JP');
            },

            // ÊôÇÂàª„Éï„Ç©„Éº„Éû„ÉÉ„Éà
            formatTime: function(date) {
                if (!(date instanceof Date)) {
                    date = new Date(date);
                }
                return date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            }
        };

        // „Éá„Éº„ÇøÁÆ°ÁêÜ„ÇØ„É©„Çπ
        class DataManager {
            constructor() {
                this.cache = new Map();
                this.cacheExpiry = 5 * 60 * 1000; // 5ÂàÜ
            }

            // „Ç≠„É£„ÉÉ„Ç∑„É•‰ªò„Åç„Éá„Éº„ÇøÂèñÂæó
            async getData(path) {
                const cacheKey = path;
                const cached = this.cache.get(cacheKey);
                
                if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
                    return cached.data;
                }

                try {
                    const snapshot = await db.ref(path).once('value');
                    const data = snapshot.val();
                    
                    this.cache.set(cacheKey, {
                        data: data,
                        timestamp: Date.now()
                    });
                    
                    return data;
                } catch (error) {
                    console.error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
                    throw error;
                }
            }

            // „Éá„Éº„Çø‰øùÂ≠ò
            async saveData(path, data) {
                try {
                    await db.ref(path).set(data);
                    // „Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÁÑ°ÂäπÂåñ
                    this.cache.delete(path);
                    return true;
                } catch (error) {
                    console.error('„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    throw error;
                }
            }

            // „Éê„ÉÉ„ÉÅÊõ¥Êñ∞
            async batchUpdate(updates) {
                try {
                    await db.ref().update(updates);
                    // Èñ¢ÈÄ£„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÁÑ°ÂäπÂåñ
                    for (const path in updates) {
                        this.cache.delete(path);
                    }
                    return true;
                } catch (error) {
                    console.error('„Éê„ÉÉ„ÉÅÊõ¥Êñ∞„Ç®„É©„Éº:', error);
                    throw error;
                }
            }

            // „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢
            clearCache() {
                this.cache.clear();
            }
        }

        // „Éá„Éº„Çø„Éû„Éç„Éº„Ç∏„É£„Éº„Ç§„É≥„Çπ„Çø„É≥„Çπ
        const dataManager = new DataManager();

        // Ë™çË®ºÁä∂ÊÖãÁõ£Ë¶ñ
        auth.onAuthStateChanged(async (user) => {
            console.log('üîÑ Ë™çË®ºÁä∂ÊÖãÂ§âÊõ¥:', user ? '„É≠„Ç∞„Ç§„É≥Ê∏à„Åø' : 'Êú™„É≠„Ç∞„Ç§„É≥');
            
            if (user) {
                currentUser = user;
                console.log('‚úÖ „É¶„Éº„Ç∂„ÉºË™çË®ºÊàêÂäü:', user.uid);
                
                try {
                    // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±ÂèñÂæó
                    const userData = await dataManager.getData(`users/${user.uid}`);
                    
                    if (userData) {
                        userRole = userData.role || 'viewer';
                        console.log('üë§ „É¶„Éº„Ç∂„ÉºÂΩπÂâ≤:', userRole);
                        
                        // UIÂàùÊúüÂåñ
                        initializeDashboard(userData);
                    } else {
                        console.warn('‚ö†Ô∏è „É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                        // ÂàùÊúüË®≠ÂÆöÁîªÈù¢„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
                        window.location.href = 'user-setup-fixed.html';
                    }
                } catch (error) {
                    console.error('‚ùå „É¶„Éº„Ç∂„Éº„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
                    Utils.showMessage('„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } else {
                console.log('üîÑ Êú™Ë™çË®º„ÅÆ„Åü„ÇÅ„ÄÅ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà');
                window.location.href = 'index.html';
            }
        });

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂàùÊúüÂåñ
        function initializeDashboard(userData) {
            try {
                console.log('üîÑ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂàùÊúüÂåñÈñãÂßã');
                
                // „É¶„Éº„Ç∂„ÉºÂêçË°®Á§∫
                document.getElementById('userNameDisplay').textContent = userData.name || '„Ç≤„Çπ„Éà„É¶„Éº„Ç∂„Éº';
                
                // ÁÆ°ÁêÜËÄÖ„Çø„Éñ„ÅÆË°®Á§∫Âà∂Âæ°
                const adminTab = document.getElementById('adminTab');
                if (userRole === 'admin') {
                    adminTab.style.display = 'block';
                }
                
                // „Çø„Éñ„Ç§„Éô„É≥„ÉàË®≠ÂÆö
                setupTabEvents();
                
                // ÂàùÊúü„Çø„ÉñË°®Á§∫
                showTab('schedule');
                
                // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
                loadDashboardData();
                
                Utils.hideLoading();
                console.log('‚úÖ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂàùÊúüÂåñÂÆå‰∫Ü');
                
            } catch (error) {
                console.error('‚ùå „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                Utils.showMessage('„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Çø„Éñ„Ç§„Éô„É≥„ÉàË®≠ÂÆö
        function setupTabEvents() {
            // „Çø„Éñ„Éú„Çø„É≥„Ç§„Éô„É≥„Éà
            document.getElementById('scheduleTab').addEventListener('click', () => showTab('schedule'));
            document.getElementById('tasksTab').addEventListener('click', () => showTab('tasks'));
            document.getElementById('adminTab').addEventListener('click', () => showTab('admin'));
            
            // „É≠„Ç∞„Ç¢„Ç¶„Éà„Éú„Çø„É≥
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // ‰ªäÊó•„Éú„Çø„É≥
            document.getElementById('todayBtn').addEventListener('click', goToToday);
            
            // Êó•‰ªòÂÖ•ÂäõÂ§âÊõ¥
            document.getElementById('dateInput').addEventListener('change', onDateChange);
            
            // Ë°®Á§∫„É¢„Éº„ÉâÂ§âÊõ¥
            document.getElementById('viewModeSelect').addEventListener('change', onViewModeChange);
            
            // ÁÆ°ÁêÜËÄÖ„Éú„Çø„É≥„Ç§„Éô„É≥„Éà
            if (userRole === 'admin') {
                document.getElementById('userManagementBtn').addEventListener('click', () => {
                    window.location.href = 'admin-dashboard.html';
                });
            }
        }

        // „Çø„ÉñË°®Á§∫ÂàáÊõø
        function showTab(tabName) {
            // ÂÖ®„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // ÂÖ®„Çø„Éñ„Éú„Çø„É≥„ÇíÈùû„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂåñ
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„ÇíË°®Á§∫
            const contentId = tabName + 'Content';
            const tabId = tabName + 'Tab';
            
            document.getElementById(contentId).classList.remove('hidden');
            
            const activeTab = document.getElementById(tabId);
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-blue-500', 'text-blue-600');
            
            // „Çø„ÉñÂà•„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
            switch (tabName) {
                case 'schedule':
                    loadScheduleData();
                    break;
                case 'tasks':
                    loadTasksData();
                    break;
                case 'admin':
                    loadAdminData();
                    break;
            }
        }

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadDashboardData() {
            try {
                console.log('üîÑ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÈñãÂßã');
                
                // ‰ªäÊó•„ÅÆÊó•‰ªò„ÇíË®≠ÂÆö
                const today = new Date();
                document.getElementById('dateInput').value = today.toISOString().split('T')[0];
                
                console.log('‚úÖ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
                
            } catch (error) {
                console.error('‚ùå „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                Utils.showMessage('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadScheduleData() {
            try {
                const selectedDate = document.getElementById('dateInput').value;
                const viewMode = document.getElementById('viewModeSelect').value;
                
                console.log('üîÑ „Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„ÇøË™≠„ÅøËæº„Åø:', { selectedDate, viewMode });
                
                // „Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„ÇøÂèñÂæóÔºàÂÆüË£Ö„Å´Âøú„Åò„Å¶Ë™øÊï¥Ôºâ
                const scheduleData = await dataManager.getData(`schedules/${currentUser.uid}`);
                
                // „Çπ„Ç±„Ç∏„É•„Éº„É´Ë°®Á§∫Êõ¥Êñ∞
                updateScheduleDisplay(scheduleData, selectedDate, viewMode);
                
            } catch (error) {
                console.error('‚ùå „Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                Utils.showMessage('„Çπ„Ç±„Ç∏„É•„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Çø„Çπ„ÇØ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadTasksData() {
            try {
                console.log('üîÑ „Çø„Çπ„ÇØ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø');
                
                // „Çø„Çπ„ÇØ„Éá„Éº„ÇøÂèñÂæó
                const tasksData = await dataManager.getData(`tasks/${currentUser.uid}`);
                
                // ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ„Å®‰ªäÈÄ±„ÅÆ„Çø„Çπ„ÇØ„ÇíÂàÜÈ°û
                const today = new Date();
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay());
                
                updateTasksDisplay(tasksData, today, startOfWeek);
                
            } catch (error) {
                console.error('‚ùå „Çø„Çπ„ÇØ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                Utils.showMessage('„Çø„Çπ„ÇØ„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // ÁÆ°ÁêÜËÄÖ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadAdminData() {
            if (userRole !== 'admin') {
                Utils.showMessage('ÁÆ°ÁêÜËÄÖÊ®©Èôê„ÅåÂøÖË¶Å„Åß„Åô', 'error');
                return;
            }
            
            try {
                console.log('üîÑ ÁÆ°ÁêÜËÄÖ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø');
                
                // ÁÆ°ÁêÜËÄÖÁî®„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂá¶ÁêÜ
                // ÂÆüË£Ö„Å´Âøú„Åò„Å¶ËøΩÂä†
                
            } catch (error) {
                console.error('‚ùå ÁÆ°ÁêÜËÄÖ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                Utils.showMessage('ÁÆ°ÁêÜËÄÖ„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Çπ„Ç±„Ç∏„É•„Éº„É´Ë°®Á§∫Êõ¥Êñ∞
        function updateScheduleDisplay(scheduleData, selectedDate, viewMode) {
            const scheduleContent = document.querySelector('#scheduleDisplay #scheduleContent');
            
            if (!scheduleData) {
                scheduleContent.innerHTML = '<p class="text-gray-500">„Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            // Ë°®Á§∫„É¢„Éº„Éâ„Å´Âøú„Åò„Å¶„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË°®Á§∫
            let displayHTML = '';
            
            switch (viewMode) {
                case 'daily':
                    displayHTML = generateDailyView(scheduleData, selectedDate);
                    break;
                case 'weekly':
                    displayHTML = generateWeeklyView(scheduleData, selectedDate);
                    break;
                case 'monthly':
                    displayHTML = generateMonthlyView(scheduleData, selectedDate);
                    break;
            }
            
            scheduleContent.innerHTML = displayHTML;
        }

        // Êó•Ë°®Á§∫ÁîüÊàê
        function generateDailyView(scheduleData, selectedDate) {
            // ÂÆüË£ÖË©≥Á¥∞„ÅØË¶Å‰ª∂„Å´Âøú„Åò„Å¶Ë™øÊï¥
            return `<div class="text-center py-8">
                <p class="text-gray-500">Êó•Ë°®Á§∫: ${selectedDate}</p>
                <p class="text-sm text-gray-400">„Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„Çø„ÇíË°®Á§∫‰∫àÂÆö</p>
            </div>`;
        }

        // ÈÄ±Ë°®Á§∫ÁîüÊàê
        function generateWeeklyView(scheduleData, selectedDate) {
            return `<div class="text-center py-8">
                <p class="text-gray-500">ÈÄ±Ë°®Á§∫</p>
                <p class="text-sm text-gray-400">ÈÄ±Èñì„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË°®Á§∫‰∫àÂÆö</p>
            </div>`;
        }

        // ÊúàË°®Á§∫ÁîüÊàê
        function generateMonthlyView(scheduleData, selectedDate) {
            return `<div class="text-center py-8">
                <p class="text-gray-500">ÊúàË°®Á§∫</p>
                <p class="text-sm text-gray-400">ÊúàÈñì„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíË°®Á§∫‰∫àÂÆö</p>
            </div>`;
        }

        // „Çø„Çπ„ÇØË°®Á§∫Êõ¥Êñ∞
        function updateTasksDisplay(tasksData, today, startOfWeek) {
            const todayTasksEl = document.getElementById('todayTasks');
            const weekTasksEl = document.getElementById('weekTasks');
            
            if (!tasksData) {
                todayTasksEl.innerHTML = '<p class="text-gray-500">‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                weekTasksEl.innerHTML = '<p class="text-gray-500">‰ªäÈÄ±„ÅÆ„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            // „Çø„Çπ„ÇØ„Éá„Éº„Çø„ÅÆË°®Á§∫Âá¶ÁêÜÔºàÂÆüË£Ö„Å´Âøú„Åò„Å¶Ë™øÊï¥Ôºâ
            todayTasksEl.innerHTML = '<p class="text-gray-500">‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>';
            weekTasksEl.innerHTML = '<p class="text-gray-500">‰ªäÈÄ±„ÅÆ„Çø„Çπ„ÇØ„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>';
        }

        // ‰ªäÊó•„Éú„Çø„É≥„Ç§„Éô„É≥„Éà
        function goToToday() {
            const today = new Date();
            document.getElementById('dateInput').value = today.toISOString().split('T')[0];
            loadScheduleData();
        }

        // Êó•‰ªòÂ§âÊõ¥„Ç§„Éô„É≥„Éà
        function onDateChange() {
            loadScheduleData();
        }

        // Ë°®Á§∫„É¢„Éº„ÉâÂ§âÊõ¥„Ç§„Éô„É≥„Éà
        function onViewModeChange() {
            loadScheduleData();
        }

        // „É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ
        function logout() {
            auth.signOut().then(() => {
                console.log('‚úÖ „É≠„Ç∞„Ç¢„Ç¶„ÉàÊàêÂäü');
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('‚ùå „É≠„Ç∞„Ç¢„Ç¶„Éà„Ç®„É©„Éº:', error);
                Utils.showMessage('„É≠„Ç∞„Ç¢„Ç¶„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            });
        }

        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
        window.addEventListener('error', (event) => {
            console.error('‚ùå JavaScript „Ç®„É©„Éº:', event.error);
            Utils.showMessage('‰∫àÊúü„Åó„Å™„ÅÑ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
        });

        // ÂàùÊúüÂåñÂÆå‰∫Ü„É≠„Ç∞
        document.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ Dashboard.html ÂàùÊúüÂåñÂÆå‰∫Ü');
        });
    </script>
</body>
</html>
